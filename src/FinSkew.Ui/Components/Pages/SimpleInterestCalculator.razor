@page "/simpleinterestcalculator"
@page "/simpleinterestcalc"
@page "/simple-interest-calculator"
@page "/simple-interest-calc"
@page "/sic"

@inject ICalculator<SimpleInterestInputViewModel, SimpleInterestResultViewModel> Calculator

<PageTitle>Simple Interest Calculator</PageTitle>

<PageHeader BreadcrumbItems="@(
                             [
                                 new BreadcrumbItem("Calculators", "#"),
                                 new BreadcrumbItem("Simple Interest", null, true)
                             ])"
            ActionButtonHidden="true"/>

<MudStack Row="true"
          Wrap="Wrap.Wrap"
          Style="background-color:#FFFFFF;">
    @* Inputs Section *@
    <MudPaper class="pa-3 mx-3 rounded-lg"
              Style="background-color:#FAFAFA;"
              Elevation="0"
              role="region"
              aria-label="Input parameters">
        <MudStack Row="true">
            <MudStack Row="true">
                <MudForm @bind-IsValid="_isFormValid"
                         Model="_inputViewModel"
                         aria-label="Simple interest calculation inputs">
                    @* TODO: Use format specifier to show thousands separator *@
                    <MudNumericField T="int"
                                     Culture="@(CultureInfo.GetCultureInfo("en-In"))"
                                     Format="N0"
                                     Margin="Margin.Dense"
                                     Adornment="Adornment.Start"
                                     AdornmentColor="Color.Tertiary"
                                     AdornmentIcon="@Icons.Material.Filled.CurrencyRupee"
                                     IconSize="Size.Small"
                                     Label="Invested Amount"
                                     Variant="Variant.Outlined"
                                     @bind-Value="_inputViewModel.PrincipalAmount"
                                     Min="10000"
                                     Max="100000000"
                                     Step="1000"
                                     HelperText="Enter amount between ₹10,000 and ₹10,00,00,000"
                                     aria-label="Invested amount in Indian Rupees"
                                     Class="mb-4"/>
                    <MudNumericField T="double"
                                     Margin="Margin.Dense"
                                     Adornment="Adornment.Start"
                                     AdornmentColor="Color.Tertiary"
                                     AdornmentIcon="@Icons.Material.Filled.Percent"
                                     IconSize="Size.Small"
                                     Label="Annual Interest Rate"
                                     Variant="Variant.Outlined"
                                     @bind-Value="_inputViewModel.RateOfInterest"
                                     Step="0.5"
                                     Min="1"
                                     Max="100"
                                     HelperText="Annual interest rate (1% to 100%)"
                                     aria-label="Annual interest rate as percentage"
                                     Class="mb-4"/>
                    <MudNumericField T="int"
                                     Margin="Margin.Dense"
                                     Adornment="Adornment.Start"
                                     AdornmentColor="Color.Tertiary"
                                     AdornmentIcon="@Icons.Material.Filled.AccessTime"
                                     IconSize="Size.Small"
                                     Label="Time Period (Years)"
                                     Variant="Variant.Outlined"
                                     @bind-Value="_inputViewModel.TimePeriodInYears"
                                     Step="1"
                                     Min="1"
                                     Max="100"
                                     HelperText="Investment period (1 to 100 years)"
                                     aria-label="Time period in years"
                                     Class="mb-4"/>
                </MudForm>
            </MudStack>
            <MudSpacer/>
        </MudStack>
    </MudPaper>

    @* Results Section *@
    <MudPaper class="pa-3 mx-3 rounded-lg"
              Style="background-color:#FAFAFA;"
              Elevation="0"
              role="region"
              aria-label="Results">
        <MudStack Justify="Justify.Center"
                  AlignItems="AlignItems.Center">
            <div role="img"
                 class="mb-2"
                 aria-label="@($"Donut chart showing invested amount of {CalculateResult(_inputViewModel).Inputs.PrincipalAmount:n0} rupees and total gain of {CalculateResult(_inputViewModel).TotalInterestEarned:n0} rupees")">
                <MudChart T="double"
                          ChartType="ChartType.Donut"
                          Class="mb-6"
                          Height="300px"
                          Width="300px"
                          @bind-SelectedIndex="@Index"
                          ChartLabels="@_donutChartLabels"
                          ChartSeries="@([DonutChartData])"
                          LegendPosition="Position.Top">
                </MudChart>
            </div>
            <MudStack Class="mt-4"
                      Style="width:100%;max-width:420px;"
                      role="list"
                      aria-label="Calculation results summary">
                <MudPaper Outlined="true"
                          Style="background-color:#FAFAFA;"
                          Class="px-3 py-2"
                          role="listitem">
                    <MudStack Row="true"
                              AlignItems="AlignItems.Center"
                              Justify="Justify.SpaceBetween">
                        <MudText Typo="Typo.body2">
                            Invested Amount
                        </MudText>
                        <MudText Typo="Typo.body1"
                                 aria-label="@($"Invested amount: {CalculateResult(_inputViewModel).PrincipalAmountStr}")">
                            @CalculateResult(_inputViewModel).PrincipalAmountStr
                        </MudText>
                    </MudStack>
                </MudPaper>
                <MudPaper Outlined="true"
                          Style="background-color:#FAFAFA;"
                          Class="px-3 py-2"
                          role="listitem">
                    <MudStack Row="true"
                              AlignItems="AlignItems.Center"
                              Justify="Justify.SpaceBetween">
                        <MudText Typo="Typo.body2">
                            Total Gain
                        </MudText>
                        <MudText Typo="Typo.body1"
                                 aria-label="@($"Total gain: {CalculateResult(_inputViewModel).TotalInterestEarnedStr}")">
                            @CalculateResult(_inputViewModel).TotalInterestEarnedStr
                        </MudText>
                    </MudStack>
                </MudPaper>
                <MudPaper Outlined="true"
                          Style="background-color:#FAFAFA;"
                          Class="px-3 py-2"
                          role="listitem">
                    <MudStack Row="true"
                              AlignItems="AlignItems.Center"
                              Justify="Justify.SpaceBetween">
                        <MudText Typo="Typo.h6"
                                 Style="font-weight:bold">
                            Final Amount
                        </MudText>
                        <MudText Typo="Typo.body1"
                                 aria-label="@($"Final amount: {CalculateResult(_inputViewModel).TotalAmountStr}")">
                            @CalculateResult(_inputViewModel).TotalAmountStr
                        </MudText>
                    </MudStack>
                </MudPaper>
            </MudStack>
        </MudStack>
    </MudPaper>

    @* Growth Section *@
    <MudPaper class="pa-3 mx-3 rounded-lg"
              Style="background-color:#FAFAFA;"
              Elevation="0"
              role="region"
              aria-label="Growth over time">
        <MudStack Justify="Justify.Center"
                  AlignItems="AlignItems.Center">
            <MudSimpleTable Dense="true"
                            Bordered="true"
                            Elevation="0"
                            aria-label="Table showing yearly growth of investment">
                <thead>
                <tr>
                    <th align="center">Year</th>
                    <th align="right">Final Amount</th>
                </tr>
                </thead>
                <tbody>
                @{
                    var result = CalculateResult(_inputViewModel);
                    for (var year = 1; year <= result.YearlyGrowth.Length; year++)
                    {
                        <tr>
                            <td align="center">@year</td>
                            <td align="justify"
                                aria-label="@($"Final amount at the end of year {year}: {result.YearlyGrowth[year - 1]} rupees")">
                                @result.YearlyGrowthAsStr[year - 1]
                            </td>
                        </tr>
                    }
                }
                </tbody>
            </MudSimpleTable>
        </MudStack>
    </MudPaper>
</MudStack>

@code {

    private bool _isFormValid;

    private readonly SimpleInterestInputViewModel _inputViewModel = new();

    private int Index { get; set; } = -1;

    private readonly string[] _donutChartLabels =
    [
        "Invested Amount",
        "Total Gain"
    ];

    private double[] DonutChartData
    {
        get
        {
            var result = CalculateResult(_inputViewModel);
            return [result.Inputs.PrincipalAmount, result.TotalInterestEarned];
        }
    }

#if FUTURE
    private string[] LineChartLabels
    {
        get
        {
            var result = CalculateResult(_inputViewModel);
            return Enumerable.Range(1, result.YearlyGrowth.Length)
                             .Select(year => year.ToString())
                             .ToArray();
        }
    }

    private List<ChartSeries<double>> LineChartSeries
    {
        get
        {
            var result = CalculateResult(_inputViewModel);
            return 
            [
                new ChartSeries<double>
                {
                    Name = "Final Amount",
                    Data = result.YearlyGrowth.Select(elem => (double)elem).ToArray()
                }
            ];
        }
    }

    private readonly LineChartOptions _lineChartOptions = new()
    {
        LineDisplayType = LineDisplayType.Line,
        ShowDataMarkers = true,
        YAxisLines = true,
        XAxisLines = true,
        LineStrokeWidth = 5,
    };

#endif

    private SimpleInterestResultViewModel CalculateResult(SimpleInterestInputViewModel input)
    {
        return Calculator.Compute(input);
    }

}